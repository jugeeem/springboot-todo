{
  "name": "Spring Boot TODO API",
  "dockerComposeFile": "docker-compose.yml",
  "service": "app",
  "workspaceFolder": "/app",

  // Dev Container内で実行するカスタマイズ（拡張機能なし）
  "customizations": {
    "vscode": {
      "devContainers": {
        "cacheMountSource": "devcontainer-cache"
      }
    }
  },

  // 環境変数
  "remoteEnv": {
    "JAVA_HOME": "/opt/java/openjdk"
  },

  // ポートフォワーディング
  "forwardPorts": [8080, 5436],
  "portsAttributes": {
    "8080": {
      "label": "Spring Boot App",
      "onAutoForward": "notify"
    },
    "5436": {
      "label": "PostgreSQL",
      "onAutoForward": "silent"
    }
  },

  // コンテナメモリ設定
  "containerEnv": {
    "VSCODE_SERVER_MEMORY_LIMIT": "2048"
  },

  // コンテナ内でrootで実行しない
  "remoteUser": "vscode",

  // VS Code拡張キャッシュをスキップ
  "otherPortsAttributes": {
    "onAutoForward": "silent"
  },

  // コンテナ起動後の初期化コマンド（初回のみ）
  "postCreateCommand": "echo 'Dev Container setup complete.'",

  // コンテナ起動時の自動実行コマンド（毎回）
  // Spring Bootをバックグラウンドで起動
  "postStartCommand": "bash -c 'cd /app/api && nohup ./gradlew bootRun > /tmp/spring-boot.log 2>&1 & disown'"
}
